<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- font awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">

    <!-- Bootstrap 4.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

    <!-- bootswatch -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.1.1/cyborg/bootstrap.min.css">

    <title>GifTastic</title>

    <!-- css styles -->
    <style type="text/css">

        a {
            text-decoration: none !important;
            color: inherit !important;
        }

        #gifs {
            display: grid;
            /*margin: 0 auto;*/
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            grid-auto-rows: minmax(150px, auto);
            grid-auto-flow: dense;
            grid-gap: 40px;
        }

/*        
        .img-gif {
            object-fit: cover;
            width: 100%;
            max-height: 100%;
        }
*/
    </style>
</head>
<body>

    <!-- Page Content-->
    <div class="container-fluid m-auto">

        <div class="row mx-5">
            <h1 class="text-center text-primary display-4 col-12 mt-4 mb-3">The Greatness of GIFs</h1>
        </div>

        <!-- Search criteria -->
        <div class="card border-0 mx-5">
            <div class="card-header bg-transparent border-0 text-primary">
                <h5 class="card-title m-0">
                    <a id="topic-section" class="" data-toggle="collapse" href="#collapse1">Topics
                        <i class="fa fa-chevron-circle-up ml-2" id="collapsed-chevron"></i>
                    </a>
                </h5>
            </div>

            <div id="collapse1" class="card-collapse collapse show">
                <div class="card-block">

                    <!-- Topic Buttons -->
                    <div class="row">
                        <div class="col-12 w-auto">
                            <!--div id="topic-list" ondrop="drop(event,this);" ondragover="allowDrop(event);"-->
                            <div id="topic-list">
                            </div>
                            <div id="search-types" class="col-2">
                            </div>
                            <div class="ml-3 mr-auto mt-2">
                                <input type="checkbox" id="clear-results" name="clear-gifs" value="clear" checked/>
                                <label for="clear">Clear GIFs on Search</label>
                            </div>
                        </div>
                    </div>

                    <!-- New Topics -->
                    <form role="form" class="m-0">
                        <div class="form-group row m-2 d-flex">
                            <!--label class="col-form-label col-sm-1" for="topic-input">Topic:</label-->
                            <input class="form-control input-md ml-1 col-2" id="topic-input" type="text" placeholder="Add new topic" autofocus>
                            <button class="btn btn-secondary btn-md ml-3 px-3" id="add-topic" type="submit">Submit</button>

                            <span id="message" class="ml-3 mt-1"></span>
                        </div>
                    </form>

                </div>
            </div>
        </div>

        <!--hr-->

        <!-- Gif Results -->
        <div class="row mx-5 mt-4">
            <div class="col-12">
                <div id="gifs">
                </div>
            </div>
        </div>

    </div>

    <!-- Giphy API -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script type="text/javascript">

        ///////////////////////////////////////////
        // Variables
        ///////////////////////////////////////////
        var topics = ["clapping", "LOL", "The Incredibles", "cat", "Bob Ross", "summer", "minions", "Nike", "holiday", "mountains", "beaches", "hiking", "sking", "play", "sleep", "movies", "Yoda", "The Office", "Parks and Rec", "college football", "celebration", "Happy Dance", "Favorites"];
        var favoriteGIFs = [];

        ///////////////////////////////////////////
        // JavaScript
        ///////////////////////////////////////////
        // function allowDrop(ev) {
        //     ev.preventDefault();
        // }

        // function drag(ev) {
        //     ev.dataTransfer.setData("text/plain", ev.target.id);
        // }

        // function drop(ev) {
        //     ev.preventDefault();
        //     var data = ev.dataTransfer.getData("text/plain");
        //     ev.target.appendChild(document.getElementById(data));
        // }


        function isEmpty(val) {
            return (val === undefined || val == null || val.length <= 0) ? true : false;
        };

        function ProperCase(txt) {
            return txt.replace(/\w\S*/g, c => c.charAt(0).toUpperCase() + c.substr(1).toLowerCase());
        };

        function createTopicButtons()
        {
            topics.sort(function (a, b) {
                return a.toLowerCase().localeCompare(b.toLowerCase());
            });

            topics.forEach(element => {
                console.log(element);
                
                // add a button for each element in the array
                addTopicButton(element);
            });

        };

        function addTopicButton(item) {
            //p2.text(ProperCase(results[i].title));                          // Capitalize the first letter of every word
            var properCaseItem = ProperCase(item);

            // add a button
            var newBtn = $("<button>");
            newBtn.attr("id",`topic-${properCaseItem}`)
            newBtn.attr("data-topic",properCaseItem);
            // newBtn.attr("draggable",true);                              // make the button draggable
            // newBtn.attr("ondragstart","drag(event)");                   // make the button draggable
            newBtn.addClass("search-button btn btn-primary btn-md my-2 mx-2");
            newBtn.text(properCaseItem);

            if (item === "Favorites") {
                var attachTo = $("#search-types");
                // newBtn.removeClass("btn-dark");
                // newBtn.addClass("btn-outline-dark");

                //<i class="far fa-star" aria-hidden="true"></i>  fas for solid
                var star = $("<i>");
                star.addClass("fas fa-star text-warning mr-1");
                star.attr("aria-hidden","true");
        // newBtn.prepend(star);
        
        // attachTo.append(newBtn);
            } else {
                var attachTo = $("#topic-list");
                attachTo.append(newBtn);
            }
            
        }

        ///////////////////////////////////////////
        // JQuery
        ///////////////////////////////////////////
        $(document).ready (function() {

            createTopicButtons();

            //onclick="$('#collapsed-chevron').toggleClass('fa-rotate-180')"
            $("#topic-section").on("click",function() {
                event.preventDefault();
                $('#collapsed-chevron').toggleClass('fa-rotate-180');
            })

            $("#add-topic").on("click", function() {
                event.preventDefault();

                console.log("add topic submit");

                var inputData = $("#topic-input").val().trim();
                $("#topic-input").val("");

                // if a value is given
                if (!isEmpty(inputData)) {

                    // if topic is not already in the list
                    if (topics.indexOf(inputData) === -1) {
                        // adds to array
                        topics.push(inputData);

                        // add a new button for the topic
                        //addTopicButton(inputData);

                        // empty all the topics and reload them all
                        var t = $("#topic-list");
                        t.empty();
                        var fav = $("#search-types");
                        fav.empty();

                        createTopicButtons();

                        $("#message").text("");
                    } else {
                        $("#message").text("Duplicate Topic.");
                    }
                }
            });

            $("#topic-list").delegate("button.search-button","click", function() {

                // prevent the page from reloading
                event.preventDefault();

                // clear any messges that remain from adding duplicate topics
                $("#message").text("");
                
                // set up query string
                var topic = $(this).attr("data-topic");
                var itemLimit = 10;
                const USER_API_KEY = "qE5VEI7m7vEyr5u78viHHZEPaPRIkgo8";

                var queryURL = "https://api.giphy.com/v1/gifs/search?" +
                    "q=" + topic + 
                    "&api_key=" + USER_API_KEY +
                    "&limit=" + itemLimit;
                console.log(queryURL);

                // clear current results
                if (document.getElementById("clear-results").checked) {
                    $("#gifs").empty();
                }

                $.ajax({
                    url: queryURL,
                    method: "GET"
                }).then(function(response) {
                    console.log(response);
            
                    var results = response.data;                                            // data returned from Giphy app
            
                    for (var i = 0; i < results.length; i++) {

                        /* sample for construction
                        <div class="card" style="width:400px">                                               
                            <img class="card-img-top"/>
                            <div class="card-body">
                            <h4 class="card-title">John Doe</h4>
                            <p class="card-text">Some example text some example text. John Doe is an architect and engineer</p>
                            </div>
                        </div>
                        */

                        // construct the HTML that will be added
                        var cardDiv = $("<div>");
                        cardDiv.addClass("card");

                        var gifImageElem = $("<img>");
                        gifImageElem.attr("src",results[i].images.fixed_height_still.url);
                        if (!isEmpty(results[i].images.title)) {
                            gifImageElem.attr("alt", results[i].images.title.trim());
                        } else {
                            gifImageElem.attr("alt", "GIF image");
                        };
                        gifImageElem.attr("data-static",results[i].images.fixed_height_still.url);
                        gifImageElem.attr("data-animated",results[i].images.fixed_height.url);
                        gifImageElem.addClass("card-img-top animate");                                      // img-gif

                        var cardBodyDiv = $("<div>");
                        cardBodyDiv.addClass("card-body");

                        var titleElem =  $("<h5>");
                        if (!isEmpty(results[i].title)) {
                            titleElem.text(ProperCase(results[i].title.trim()));                          // Capitalize the first letter of every word
                        } else {
                            titleElem.text("NONE");
                        };

                        var ratingElem =  $("<p>");
                        ratingElem.addClass("mb-0");
                        if (!isEmpty(results[i].rating)) {
                            ratingElem.text("Rated " + results[i].rating.trim().toUpperCase());
                        } else {
                            ratingElem.text("Not Rated");
                        };

                        cardBodyDiv.append(titleElem);
                        cardBodyDiv.append(ratingElem);
                        cardDiv.append(gifImageElem);
                        cardDiv.append(cardBodyDiv);

                        // add the elements to the DOM
                        $("#gifs").prepend(cardDiv);
            
                    };
            
                });

            });

            $("#gifs").delegate(".animate", "click", function() {
                // prevent the page from reloading
                event.preventDefault();

                console.log("GIF ready to animate");

                var currentSrc =  $(this).attr("src");
                var animatedGIF = $(this).attr("data-static");
                var staticGIF = $(this).attr("data-animated");

                console.log(currentSrc);
                console.log(animatedGIF);
                console.log(staticGIF);
                
                if (currentSrc === animatedGIF) {
                    $(this).attr("src",staticGIF);    
                } else {
                    $(this).attr("src",animatedGIF);
                }

            });

        });
    </script>

    <!-- Bootstrap 4.1 -->
    <!--script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script-->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

</body>
</html>